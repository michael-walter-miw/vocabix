<div class="exam-container">
  <h2 class="exam-title">üìù Pr√ºfung</h2>

  @if (wordPairs.length === 0) {
    <div class="exam-warning" role="alert">
      <div class="alert alert-warning">
        Keine Wortpaare gefunden. Bitte erfasse zuerst welche unter
        <a routerLink="/edit">Editieren</a>.
      </div>
    </div>
  }

  @if (!questions.length && wordPairs.length > 0) {
    <div class="exam-options mb-4">
      <label class="form-label"><strong>Wie viele W√∂rter sollen gepr√ºft werden?</strong></label>

      <div class="form-check">
        <input class="form-check-input" type="radio" name="examSize" id="size5" value="5"
               [checked]="examSize() === '5'" (change)="setExamSize('5')"/>
        <label class="form-check-label" for="size5">5</label>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="radio" name="examSize" id="size10" value="10"
               [checked]="examSize() === '10'" (change)="setExamSize('10')"/>
        <label class="form-check-label" for="size10">10</label>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="radio" name="examSize" id="sizeAll" value="all"
               [checked]="examSize() === 'all'" (change)="setExamSize('all')"/>
        <label class="form-check-label" for="sizeAll">Alle</label>
      </div>

      <button class="btn btn-primary mt-3" (click)="startExam()">
        Pr√ºfung starten
      </button>
    </div>
  }

  @if (!finished && questions.length > 0) {
    <div class="exam-question-card">
      <div class="exam-question-header">
        <strong>Frage {{ currentIndex + 1 }} von {{ questions.length }}:</strong>
      </div>

      <div class="exam-question-prompt">
        <strong>{{ questions[currentIndex].prompt }}</strong>
      </div>

      <form (ngSubmit)="submit()" aria-label="Frage beantworten">
        <input
          class="form-control exam-input"
          [(ngModel)]="userInput"
          name="answer"
          placeholder="Antwort eingeben"
          aria-label="Antwort eingeben"
          [attr.aria-describedby]="'hint-' + currentIndex"
          required
          data-testid="answer-input"
        />
        <small id="hint-{{ currentIndex }}" class="form-text text-muted">
          Bitte die √úbersetzung eingeben
        </small>
        <button
          class="btn btn-primary mt-2"
          type="submit"
          [disabled]="!userInput.trim()"
          data-testid="submit-button"
        >
          Antwort pr√ºfen
        </button>
      </form>

      <div class="progress my-3" style="height: 10px">
        <div
          class="progress-bar"
          role="progressbar"
          [style.width.%]="percentage"
          aria-valuenow="{{ percentage }}"
          aria-valuemin="0"
          aria-valuemax="100"
        ></div>
      </div>
    </div>
  }

  @if (finished) {
    <div class="exam-results" aria-live="polite">
      <h4>üìä Ergebnis</h4>
      <p>
        Richtig: <strong>{{ correctCount }}</strong> von {{ total }} |
        Trefferquote: <strong>{{ percentage }}%</strong>
      </p>

      <table class="table table-bordered exam-result-table">
        <thead class="table-light">
        <tr>
          <th>Frage</th>
          <th>Antwort</th>
          <th>Deine Antwort</th>
          <th>‚úì</th>
        </tr>
        </thead>
        <tbody>
          @for (r of results; track r) {
            <tr [ngClass]="getRowClass(r.correct)" data-testid="result-row">
              <td>{{ r.question }}</td>
              <td>{{ r.expected }}</td>
              <td>{{ r.given }}</td>
              <td>
                <span [class.text-success]="r.correct" [class.text-danger]="!r.correct">
                  {{ getIcon(r.correct) }}
                </span>
              </td>
            </tr>
          }
        </tbody>
      </table>

      <div class="exam-actions">
        <button class="btn btn-secondary" (click)="restart()" data-testid="restart-button">
          Neu starten
        </button>
        <button class="btn btn-outline-primary" (click)="back()" data-testid="back-button">
          Zur√ºck zur Erfassung
        </button>
      </div>
    </div>
  }
</div>
